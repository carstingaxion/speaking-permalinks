(()=>{"use strict";const t=window.wp.plugins,e=window.wp.data,r=window.wp.editor,n=window.wp.element,o=window.wp.coreData,s=window.wp.date;function i(t,e){return e?"lower"===e?t.toLowerCase():"upper"===e?t.toUpperCase():t:t}function u(t,e,r,n=!1){if(!e)return"";const o=function(t){return t?"object"!=typeof t||null===t?String(t):void 0!==t.raw?t.raw:void 0!==t.rendered?String(t.rendered).replace(/<[^>]*>/g,""):String(t):""}(e);if(!r)return o;const u=/[YymdHisaABgGhFjlMnStTwWzZ]/.test(r);if("date"===t||n&&u){if(n&&!function(t){if(!t)return!1;if("string"==typeof t){if(/^\d{4}-\d{2}-\d{2}/.test(t))return!0;if(/^\d{10,13}$/.test(t))return!0}if("number"==typeof t){const e=String(t);if(e.length>=10&&e.length<=13)return!0}return!1}(o))return i(o,r);const t=function(t,e){if(!t)return"";if(e)try{return(0,s.dateI18n)(e,t)}catch(t){}try{const r=new Date(t);if(isNaN(r.getTime()))return"";const n=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),s=String(r.getDate()).padStart(2,"0");return"Y-m-d"!==e&&e?"Y"===e?String(n):"m"===e?o:"d"===e?s:`${n}-${o}-${s}`:`${n}-${o}-${s}`}catch(t){return console.error("[Speaking Permalinks] Date formatting error:",t),""}}(o,r);if(t)return t}return i(o,r)}const a=({postType:t,postId:s,template:i})=>{const a=(0,n.useMemo)(()=>function(t){if(!t)return[];const e=[],r=/\{([^}]+)\}/g;let n;for(;null!==(n=r.exec(t));){const t=n[1],r=t.startsWith("meta:"),o=t.startsWith("tax:");let s=t;r?s=t.substring(5):o&&(s=t.substring(4));const i=s.split("|"),u=i.length>1?i[i.length-1]:null,a=i[0].split(":"),l=a[0],c=a.length>1?a[1]:null;e.push({field:l,arrayKey:c,format:u,isMeta:r,isTax:o,raw:t})}return e}(i),[i]),{postFields:l,taxonomySlugs:c}=(0,n.useMemo)(()=>function(t){return{postFields:[...new Set(t.filter(t=>!t.isMeta&&!t.isTax).map(t=>t.field))],metaFields:[...new Set(t.filter(t=>t.isMeta).map(t=>t.field))],taxonomySlugs:[...new Set(t.filter(t=>t.isTax).map(t=>t.field))]}}(a),[a]),p=(0,e.useSelect)(t=>{const{getEditedPostAttribute:e}=t(r.store),n={};return l.forEach(t=>{try{n[t]=e(t)}catch(e){n[t]=""}}),n},[l]),[f]=(0,o.useEntityProp)("postType",t,"meta",s),{taxonomyTermIds:d}=function(t){const o=(0,e.useSelect)(e=>{const r={};return t.forEach(t=>{const n=e("core").getTaxonomy(t);if(n){const e=n.rest_base||t;r[t]=e}else r[t]=t}),r},[t]),s=(0,n.useMemo)(()=>o,[o]),i=(0,e.useSelect)(e=>{const{getEditedPostAttribute:n}=e(r.store),o={};return t.forEach(t=>{const e=s[t]||t;try{const r=n(e);o[t]=r||[]}catch(e){o[t]=[]}}),o},[t,s]),u=(0,n.useMemo)(()=>i,[i]);return{taxonomyRestBases:s,taxonomyTermIds:u}}(c),g=function(t,r){const o=(0,e.useSelect)(e=>{const n={};return t.forEach(t=>{const o=r[t];if(o&&o.length>0){const r=o.map(r=>e("core").getEntityRecord("taxonomy",t,r)).filter(Boolean);if(r.length>0){const e=r.map(t=>t.slug);n[t]=e.join("-")}}}),n},[t,r]);return(0,n.useMemo)(()=>o,[o])}(c,d),[m,y]=(0,o.useEntityProp)("postType",t,"slug",s),w=(0,n.useRef)(""),S=JSON.stringify(p),h=(0,n.useMemo)(()=>S,[S]),T=JSON.stringify(f),M=(0,n.useMemo)(()=>T,[T]),x=JSON.stringify(d),k=(0,n.useMemo)(()=>x,[x]),P=JSON.stringify(g),E=(0,n.useMemo)(()=>P,[P]);return(0,n.useEffect)(()=>{if(!s||!i)return;if("{title}"===i)return;const t=setTimeout(()=>{const t=function(t,e,r,n,o){return t?function(t){const e=t.split("-").filter(t=>""!==t.trim());return(t=e.join("-")).toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}(t.replace(/\{([^}]+)\}/g,(t,s)=>{const i=e.find(t=>t.raw===s);if(!i)return"";if(i.isTax)return o&&o[i.field]?o[i.field]:"";if(i.isMeta){let t=n&&void 0!==n[i.field]?n[i.field]:"";if(i.arrayKey&&t){if("object"!=typeof t||null===t)return"";if(t=t[i.arrayKey],null==t)return""}return u(i.field,t,i.format,!0)}const a=r[i.field];return u(i.field,a,i.format,!1)})):""}(i,a,p,f||{},g||{});t&&t!==m&&t!==w.current&&(w.current=t,y(t))},200);return()=>clearTimeout(t)},[s,i,h,M,k,E,m,y,a,p,f,g]),null},l=window.ReactJSXRuntime;(0,t.registerPlugin)("speaking-permalinks",{render:()=>{const{postType:t,postId:n,hasSpeakingPermalinksSupport:o,template:s}=(0,e.useSelect)(t=>{const e=t(r.store);if(!e)return{postType:null,postId:null,hasSpeakingPermalinksSupport:!1,template:""};const n=e.getCurrentPostType(),o=t("core").getPostType(n),s=o?.supports||{},i=s["speaking-permalinks"]?.[0]||!1;let u="";return i&&(u=i.template),{postType:n,postId:e.getCurrentPostId(),hasSpeakingPermalinksSupport:i,template:u}},[]);return o&&t&&n&&s?(0,l.jsx)(a,{postType:t,postId:n,template:s}):null}})})();