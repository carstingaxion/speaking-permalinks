(()=>{"use strict";const t=window.wp.plugins,e=window.wp.element,r=window.wp.data,n=window.wp.coreData,i=window.wp.editor,s=window.wp.date,o=window.ReactJSXRuntime,a=({postType:t,postId:s,template:o})=>{const a=(0,e.useMemo)(()=>function(t){if(!t)return[];const e=[],r=/\{([^}]+)\}/g;let n;for(;null!==(n=r.exec(t));){const t=n[1],r=t.startsWith("meta:"),i=t.startsWith("tax:"),s=(r?t.substring(5):i?t.substring(4):t).split("|"),o=s.length>1?s[s.length-1]:null,a=s[0].split(":"),l=a[0],u=a.length>1?a[1]:null;e.push({field:l,arrayKey:u,format:o,isMeta:r,isTax:i,raw:t})}return e}(o),[o]),u=(0,e.useMemo)(()=>[...new Set(a.filter(t=>!t.isMeta&&!t.isTax).map(t=>t.field))],[a]),p=((0,e.useMemo)(()=>[...new Set(a.filter(t=>t.isMeta).map(t=>t.field))],[a]),(0,e.useMemo)(()=>[...new Set(a.filter(t=>t.isTax).map(t=>t.field))],[a])),c=(0,r.useSelect)(t=>{const{getEditedPostAttribute:e}=t(i.store),r={};return u.forEach(t=>{try{r[t]=e(t)}catch(e){r[t]=""}}),r},[u.join(","),t,s]),[f]=(0,n.useEntityProp)("postType",t,"meta",s),g=(0,r.useSelect)(t=>{const e={};return p.forEach(r=>{const n=t("core").getTaxonomy(r);if(n){const t=n.rest_base||r;e[r]=t}else e[r]=r}),e},[p.join(",")]),d=(0,r.useSelect)(t=>{const{getEditedPostAttribute:e}=t(i.store),r={};return p.forEach(t=>{const n=g[t]||t;try{const i=e(n);r[t]=i||[]}catch(e){r[t]=[]}}),r},[p.join(","),JSON.stringify(g),t,s]),m=(0,r.useSelect)(t=>{const e={};return p.forEach(r=>{const n=d[r];if(n&&n.length>0){const i=n.map(e=>t("core").getEntityRecord("taxonomy",r,e)).filter(Boolean);if(i.length>0){const t=i.map(t=>t.slug);e[r]=t.join("-")}}}),e},[JSON.stringify(d),p.join(",")]),S=(0,e.useMemo)(()=>m,[JSON.stringify(m)]),[y,w]=(0,n.useEntityProp)("postType",t,"slug",s),h=(0,e.useRef)("");return(0,e.useEffect)(()=>{if(!s||!o)return;if("{title}"===o)return;const t=setTimeout(()=>{const t=function(t,e,r,n,i){if(!t)return"";let s=t.replace(/\{([^}]+)\}/g,(t,s)=>{const o=e.find(t=>t.raw===s);if(!o)return"";if(o.isTax)return i&&i[o.field]?i[o.field]:"";if(o.isMeta){let t=n&&void 0!==n[o.field]?n[o.field]:"";if(o.arrayKey&&t){if("object"!=typeof t||null===t)return"";if(t=t[o.arrayKey],null==t)return""}return l(o.field,t,o.format)}{const t=r[o.field];return l(o.field,t,o.format)}});const o=s.split("-").filter(t=>""!==t.trim());return s=o.join("-"),s=s.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),s}(o,a,c,f||{},S||{});t&&t!==y&&t!==h.current&&(h.current=t,w(t))},200);return()=>clearTimeout(t)},[s,o,JSON.stringify(c),JSON.stringify(f),JSON.stringify(d),JSON.stringify(S),y,w,a]),null};function l(t,e,r){if(!e)return"";let n=e;if("object"==typeof e&&null!==e&&(n=void 0!==e.raw?e.raw:void 0!==e.rendered?String(e.rendered).replace(/<[^>]*>/g,""):String(e)),"date"===t&&r)try{return(0,s.dateI18n)(r,n)}catch(t){try{const t=new Date(n);if(!isNaN(t.getTime())){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");if("Y-m-d"===r)return`${e}-${n}-${i}`;if("Y"===r)return String(e);if("m"===r)return n;if("d"===r)return i}}catch(t){return console.error("[Speaking Permalinks] Date formatting error:",t),""}}if("date"===t&&!r)try{const t=new Date(n);if(!isNaN(t.getTime())){const e=t.getFullYear();return`${e}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}}catch(t){return console.error("[Speaking Permalinks] Date parsing error:",t),""}let i=String(n);return r&&("lower"===r?i=i.toLowerCase():"upper"===r&&(i=i.toUpperCase())),i}(0,t.registerPlugin)("speaking-permalinks",{render:()=>{const{postType:t,postId:e,hasSpeakingPermalinksSupport:n,template:s}=(0,r.useSelect)(t=>{const e=t(i.store);if(!e)return{postType:null,postId:null,hasSpeakingPermalinksSupport:!1,template:""};const r=e.getCurrentPostType(),n=t("core").getPostType(r),s=(n?.supports||{})["speaking-permalinks"][0]||!1;let o="";return s&&(o=s.template),{postType:r,postId:e.getCurrentPostId(),hasSpeakingPermalinksSupport:s,template:o}},[]);return n&&t&&e&&s?(0,o.jsx)(a,{postType:t,postId:e,template:s}):null}})})();